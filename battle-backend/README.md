# çŸ¥è­˜ç‹å°æˆ°éŠæˆ²å¾Œç«¯ (Battle Backend)

ä¸€å€‹åŸºæ–¼ Spring Boot å’Œ WebSocket çš„å¯¦æ™‚çŸ¥è­˜ç‹å°æˆ°éŠæˆ²å¾Œç«¯æœå‹™ã€‚

## ğŸ“‹ åŠŸèƒ½ç‰¹é»

- **å¯¦æ™‚å°æˆ°**: ä½¿ç”¨ WebSocket å¯¦ç¾ä½å»¶é²çš„å¯¦æ™‚é€šä¿¡
- **æ™ºèƒ½é…å°**: è‡ªå‹•åŒ¹é…ç­‰å¾…ä¸­çš„ç©å®¶
- **é¡Œç›®ç®¡ç†**: å¾ CSV æ–‡ä»¶åŠ è¼‰é¡Œç›®ï¼Œæ”¯æŒå¤šç¨®é¡Œå‹
- **æˆ¿é–“ç®¡ç†**: å‹•æ…‹å‰µå»ºå’Œç®¡ç†éŠæˆ²æˆ¿é–“
- **åˆ†æ•¸è¨ˆç®—**: å¯¦æ™‚è¨ˆç®—å’Œå»£æ’­ç©å®¶åˆ†æ•¸
- **éŠæˆ²æµç¨‹**: å®Œæ•´çš„éŠæˆ²ç”Ÿå‘½å‘¨æœŸç®¡ç†

## ğŸ›  æŠ€è¡“æ£§

- **æ¡†æ¶**: Spring Boot 4.0.1
- **èªè¨€**: Java 21
- **é€šä¿¡**: WebSocket (STOMP)
- **æ•¸æ“šè™•ç†**: OpenCSV, Jackson
- **æ§‹å»ºå·¥å…·**: Maven

## ğŸ“ é …ç›®çµæ§‹

```
battle-backend/
â”œâ”€â”€ src/main/java/com/example/
â”‚   â”œâ”€â”€ config/                 # é…ç½®é¡
â”‚   â”‚   â”œâ”€â”€ WebConfig.java      # Web é…ç½®
â”‚   â”‚   â””â”€â”€ WebSocketConfig.java # WebSocket é…ç½®
â”‚   â”œâ”€â”€ controller/             # æ§åˆ¶å™¨
â”‚   â”‚   â””â”€â”€ BattleController.java # éŠæˆ²æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ dto/                    # æ•¸æ“šå‚³è¼¸å°è±¡
â”‚   â”‚   â”œâ”€â”€ AnswerMessage.java  # ç­”æ¡ˆæ¶ˆæ¯
â”‚   â”‚   â”œâ”€â”€ ErrorMessage.java   # éŒ¯èª¤æ¶ˆæ¯
â”‚   â”‚   â”œâ”€â”€ JoinMessage.java    # åŠ å…¥æ¶ˆæ¯
â”‚   â”‚   â”œâ”€â”€ MatchMessage.java   # é…å°æ¶ˆæ¯
â”‚   â”‚   â”œâ”€â”€ QuestionMessage.java # é¡Œç›®æ¶ˆæ¯
â”‚   â”‚   â””â”€â”€ ScoreMessage.java   # åˆ†æ•¸æ¶ˆæ¯
â”‚   â”œâ”€â”€ model/                  # æ•¸æ“šæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Player.java         # ç©å®¶æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Question.java       # é¡Œç›®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ Room.java           # æˆ¿é–“æ¨¡å‹
â”‚   â”œâ”€â”€ service/                # æ¥­å‹™é‚è¼¯
â”‚   â”‚   â”œâ”€â”€ GameService.java    # éŠæˆ²æœå‹™
â”‚   â”‚   â”œâ”€â”€ MatchmakingService.java # é…å°æœå‹™
â”‚   â”‚   â”œâ”€â”€ QuestionRepository.java # é¡Œç›®å€‰åº«
â”‚   â”‚   â””â”€â”€ RoomService.java    # æˆ¿é–“æœå‹™
â”‚   â””â”€â”€ demo/
â”‚       â””â”€â”€ BattleBackendApplication.java # ä¸»æ‡‰ç”¨é¡
â”œâ”€â”€ src/main/resources/
â”‚   â”œâ”€â”€ application.properties  # æ‡‰ç”¨é…ç½®
â”‚   â””â”€â”€ question.csv            # é¡Œç›®æ•¸æ“š
â””â”€â”€ pom.xml                     # Maven é…ç½®
```

## ğŸš€ å¿«é€Ÿé–‹å§‹

### ç’°å¢ƒéœ€æ±‚

- Java 21 æˆ–æ›´é«˜ç‰ˆæœ¬
- Maven 3.6+

### å®‰è£èˆ‡é‹è¡Œ

1. **å…‹éš†é …ç›®**
   ```bash
   git clone <repository-url>
   cd battle-backend
   ```

2. **ç·¨è­¯é …ç›®**
   ```bash
   mvn clean compile
   ```

3. **é‹è¡Œæ‡‰ç”¨**
   ```bash
   mvn spring-boot:run
   ```

4. **é©—è­‰é‹è¡Œ**
   - æœå‹™å°‡åœ¨ `http://localhost:8088` å•Ÿå‹•
   - WebSocket ç«¯é»: `ws://localhost:8088/ws`

## ğŸ“Š API æ¥å£

### WebSocket ç«¯é»

æ‰€æœ‰é€šä¿¡éƒ½é€šé STOMP over WebSocket é€²è¡Œï¼š

- **é€£æ¥ç«¯é»**: `/ws`
- **æ‡‰ç”¨ç›®çš„åœ°å‰ç¶´**: `/app`
- **ä¸»é¡Œç›®çš„åœ°å‰ç¶´**: `/topic`

### ä¸»è¦æ¶ˆæ¯é¡å‹

#### 1. é…å°è«‹æ±‚ (`/app/match`)
```json
{
  "playerId": "player123"
}
```

#### 2. åŠ å…¥æˆ¿é–“ (`/app/join`)
```json
{
  "roomId": "room456",
  "playerId": "player123"
}
```

#### 3. æäº¤ç­”æ¡ˆ (`/app/answer`)
```json
{
  "roomId": "room456",
  "playerId": "player123",
  "answer": "A",
  "answerTime": 1640995200000
}
```

### è¨‚é–±ä¸»é¡Œ

- **å€‹äººæ¶ˆæ¯**: `/topic/player/{playerId}`
- **æˆ¿é–“æ¶ˆæ¯**: `/topic/room/{roomId}`

## ğŸ® éŠæˆ²æµç¨‹

1. **é…å°éšæ®µ**
   - ç©å®¶ç™¼é€é…å°è«‹æ±‚
   - ç³»çµ±å˜—è©¦å¾ç­‰å¾…éšŠåˆ—ä¸­åŒ¹é…å°æ‰‹
   - é…å°æˆåŠŸå¾Œå‰µå»ºæˆ¿é–“ä¸¦é€šçŸ¥é›™æ–¹

2. **éŠæˆ²æº–å‚™**
   - é›™æ–¹ç©å®¶åŠ å…¥æˆ¿é–“
   - åˆå§‹åŒ–éŠæˆ²æ•¸æ“šå’Œé¡Œç›®åˆ—è¡¨

3. **é¡Œç›®æ¨é€**
   - æœå‹™å™¨æ¨é€ç¬¬ä¸€é¡Œ
   - è¨­ç½® 8 ç§’å€’è¨ˆæ™‚

4. **ç­”æ¡ˆè™•ç†**
   - ç©å®¶æäº¤ç­”æ¡ˆ
   - å¯¦æ™‚è¨ˆç®—åˆ†æ•¸
   - ç•¶é›™æ–¹éƒ½ç­”é¡Œå®Œæˆæ™‚è‡ªå‹•é€²å…¥ä¸‹ä¸€é¡Œ

5. **éŠæˆ²çµæŸ**
   - å®Œæˆ 8 é¡Œå¾Œå»£æ’­æœ€çµ‚åˆ†æ•¸
   - éŠ·æ¯€æˆ¿é–“è³‡æº

## ğŸ“š é¡Œç›®æ•¸æ“š

é¡Œç›®å­˜å„²åœ¨ `src/main/resources/question.csv` æ–‡ä»¶ä¸­ï¼ŒåŒ…å«ï¼š

- **é¡Œç›®é¡å‹**: ä¸­æ–‡æ‹¼éŸ³ã€èªæ³•å¡«ç©ºã€å°è©±ç†è§£ç­‰
- **é¡Œç›®æ•¸é‡**: 200 é“é¡Œç›®
- **æ ¼å¼**: ID,é¡Œç›®,ç­”æ¡ˆ,é¸é …1,é¸é …2,é¸é …3,é¸é …4

### é¡Œç›®ç¤ºä¾‹

```
é¡Œç›®ID,é¡Œç›®,ç­”æ¡ˆ,é¸é …1,é¸é …2,é¸é …3,é¸é …4
1,ã€Œè€ã€æ‹¼éŸ³æ˜¯ä»€éº¼ï¼Ÿ,1,lÇo,lÃ¡o,lÃ o,lao
2,ã€Œæ›¸ã€æ‹¼éŸ³æ˜¯ä»€éº¼ï¼Ÿ,2,shu,shÅ«,shÃ¹,shÇ”
```

## âš™ é…ç½®èªªæ˜

### application.properties

```properties
spring.application.name=battle-backend
server.port=8088
```

### WebSocket é…ç½®

- **å¿ƒè·³é–“éš”**: 4 ç§’
- **é‡é€£å»¶é²**: 5 ç§’
- **æ¶ˆæ¯ç·©è¡**: å•Ÿç”¨

## ğŸ”§ é–‹ç™¼æŒ‡å—

### æ·»åŠ æ–°é¡Œç›®

1. ç·¨è¼¯ `src/main/resources/question.csv`
2. æŒ‰ç…§ç¾æœ‰æ ¼å¼æ·»åŠ æ–°é¡Œç›®
3. é‡å•Ÿæœå‹™å™¨é‡æ–°åŠ è¼‰é¡Œç›®

### è‡ªå®šç¾©éŠæˆ²é‚è¼¯

ä¸»è¦ä¿®æ”¹ `GameService.java` å’Œ `BattleController.java`ï¼š

- **åˆ†æ•¸è¨ˆç®—**: ä¿®æ”¹ `GameService.submit()` æ–¹æ³•
- **éŠæˆ²è¦å‰‡**: ä¿®æ”¹ `BattleController.advance()` æ–¹æ³•
- **é¡Œç›®æ•¸é‡**: ä¿®æ”¹ `GameService` ä¸­çš„å¸¸æ•¸

### éŒ¯èª¤è™•ç†

ç³»çµ±åŒ…å«å®Œå–„çš„éŒ¯èª¤è™•ç†æ©Ÿåˆ¶ï¼š

- æˆ¿é–“å·²æ»¿éŒ¯èª¤
- ç„¡æ•ˆæ“ä½œéŒ¯èª¤
- é€£æ¥è¶…æ™‚éŒ¯èª¤

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

1. **WebSocket é€£æ¥å¤±æ•—**
   - æª¢æŸ¥ç«¯å£ 8088 æ˜¯å¦è¢«å ç”¨
   - ç¢ºèªé˜²ç«ç‰†è¨­ç½®

2. **é…å°å¤±æ•—**
   - æª¢æŸ¥ MatchmakingService é‚è¼¯
   - æŸ¥çœ‹æ§åˆ¶å°æ—¥èªŒ

3. **åˆ†æ•¸è¨ˆç®—éŒ¯èª¤**
   - æª¢æŸ¥ GameService.submit() æ–¹æ³•
   - é©—è­‰é¡Œç›®æ•¸æ“šæ ¼å¼

### æ—¥èªŒæŸ¥çœ‹

```bash
# æŸ¥çœ‹æ‡‰ç”¨æ—¥èªŒ
tail -f logs/spring.log

# èª¿è©¦æ¨¡å¼é‹è¡Œ
mvn spring-boot:run -Dspring-boot.run.arguments=--logging.level.com.example=DEBUG
```


**æ³¨æ„**: æ­¤é …ç›®éœ€è¦é…åˆå‰ç«¯æ‡‰ç”¨ç¨‹åºä½¿ç”¨ã€‚è«‹åƒè€ƒå‰ç«¯é …ç›®çš„æ–‡æª”äº†è§£å®Œæ•´çš„ä½¿ç”¨æ–¹æ³•ã€‚
